generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id           String     @id @default(uuid())
  email        String     @unique
  passwordHash String
  displayName  String
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  
  // Settings
  salePriority   Int      @default(3)
  ratingPriority Int      @default(4)
  topicPriority  Int      @default(2)

  // Relations
  ownedGames   UserGame[]
}

model Game {
  id           String     @id @default(uuid())
  title        String     @unique // Add unique constraint for de-duplication
  imageUrl     String?
  price        Int
  discountRate Int?
  isOnSale     Boolean    @default(false)
  rating       Float?
  genre        String?    // JSON stringified array or comma separated
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt

  // Relations
  ownedBy      UserGame[]
}

model UserGame {
  id         String   @id @default(uuid())
  userId     String
  gameId     String
  store      String   // Moved from Game: 'NINTENDO', 'PLAYSTATION', 'STEAM', etc.
  ownedType  String   // 'PURCHASED', 'FREE_CLAIMED', 'SUBSCRIPTION', 'MANUAL_REGISTERED'
  purchasePrice Int?  // User's specific purchase price
  createdAt  DateTime @default(now())

  updatedAt  DateTime @updatedAt

  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  game       Game     @relation(fields: [gameId], references: [id], onDelete: Cascade)

  @@unique([userId, gameId, store]) // A user can only own a specific game ONCE PER STORE
}
